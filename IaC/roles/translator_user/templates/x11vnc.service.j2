[Unit]
Description=Start x11vnc at startup.
After=multi-user.target

[Service]
Type=simple
User={{ user_name }}
PIDFile=/home/{{ user_name }}/.vnc/%H:0.pid
ExecStart=/usr/bin/x11vnc -forever -nevershared {% if main_user is defined and main_user == true %}-display :0 -auth .Xauthority{% else %}-create
Environment="X11VNC_SKIP_DISPLAY=0"
{% endif %}

ExecStop=kill $(cat /home/{{ user_name }}/.vnc/%H:0.pid)
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target